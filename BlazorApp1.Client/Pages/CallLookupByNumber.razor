@rendermode InteractiveWebAssembly
@page "/"
@using BlazorApp1.Client.ApiClient.Interface
@using BlazorApp1.Client.Models
@using Microsoft.AspNetCore.Components

<MudContainer Class="mt-4">
    <MudText Typo="Typo.h4">Call Lookup By Number</MudText>

    <MudGrid Class="mb-4">
        <MudItem xs="12" sm="3">
            <MudDatePicker @bind-Date="StartDate" Label="Start Date" />
        </MudItem>
        <MudItem xs="12" sm="3">
            <MudDatePicker @bind-Date="EndDate" Label="End Date" />
        </MudItem>
        <MudItem xs="12" sm="3">
            <MudTextField @bind-Value="Number" Label="Number" Immediate="true" />
        </MudItem>
        <MudItem xs="12" sm="3" Class="d-flex align-items-center">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Disabled="@(!CanSearch || IsLoading)" OnClick="SearchNow" FullWidth="true">
                @(IsLoading ? "Searching..." : "Search")
            </MudButton>
        </MudItem>
    </MudGrid>


    @if (IsLoading)
    {
        <MudProgressLinear Indeterminate Class="mb-4" />
    }
    else
    {
        <MudTable Items="Results" Hover="true" Bordered="true" Dense="true">
            <HeaderContent>
                <MudTh>Extension</MudTh>
                <MudTh>Call Time</MudTh>
                <MudTh>Duration</MudTh>
                <MudTh>Answered</MudTh>
                <MudTh>Number</MudTh>
                <MudTh>Incoming</MudTh>
                <MudTh>Recording</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Extension">@context.Extension</MudTd>
                <MudTd DataLabel="Call Time">@context.CallDateTime.ToString("dd/MM/yyyy HH:mm:ss")</MudTd>
                <MudTd DataLabel="Duration">@context.DurationMinutes</MudTd>
                <MudTd DataLabel="Answered">@(context.IsAnswered ? "Answered" : "Not Answered")</MudTd>
                <MudTd DataLabel="Number">@context.CallerNumber</MudTd>
                <MudTd DataLabel="Incoming">@context.Incoming</MudTd>
                <MudTd DataLabel="Recording">
                    <MudButton Variant="Variant.Outlined" Size="Size.Small" Disabled="@(!context.IsAnswered)" OnClick="@(() => DownloadAsync(context))">
                        Download Call
                    </MudButton>
                </MudTd>
            </RowTemplate>
            <NoRecordsContent>
                <MudText>No results</MudText>
            </NoRecordsContent>
        </MudTable>
    }
</MudContainer>
