@rendermode InteractiveWebAssembly
@page "/"
@using BlazorApp1.Client.ApiClient.Interface
@using BlazorApp1.Client.Models
@using Microsoft.AspNetCore.Components



<h1>Call Lookup By Number</h1>

<div class="container maxedContainer">
    <!-- Filters Row -->
    <div class="form-group row mb-3" style="gap:10px;">
        <div class="col-sm-3">
            <InputDate @bind-Value="StartDate" class="form-control" />
        </div>
        <div class="col-sm-3">
            <InputDate @bind-Value="EndDate" class="form-control" />
        </div>
        <div class="col-sm-3">
            <input class="form-control"
                   placeholder="Number"
                   @bind="Number"
                   @bind:event="oninput" />
        </div>
        <div class="col-sm-3 d-flex align-items-center">
            <button class="btn btn-primary w-100"
                    type="button"
                    @onclick="SearchNow"
                    disabled="@(!CanSearch || IsLoading)">
                @(IsLoading ? "Searching..." : "Search")
            </button>

        </div>
    </div>

    <!-- Results Grid -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered defaultTable">
            <thead>
                <tr>
                    <th>Extension</th>
                    <th>Call Time</th>
                    <th>Duration</th>
                    <th>Answered</th>
                    <th>Number</th>
                    <th>Incoming</th>
                    <th>Recording</th>
                </tr>
            </thead>
            <tbody>
                @if (IsLoading)
                {
                    <tr><td colspan="7">Loading…</td></tr>
                }
                else if (Results.Count == 0)
                {
                    <tr><td colspan="7">No results</td></tr>
                }
                else
                {
                    @foreach (var r in Results)
                    {
                        <tr>
                            <td>@r.Extension</td>
                            <td>@r.CallDateTime.ToString("dd/MM/yyyy HH:mm:ss")</td>
                            <td>@r.DurationMinutes</td>
                            <td>@(r.IsAnswered ? "Answered" : "Not Answered")</td>
                            <td>@r.CallerNumber</td>
                            <td>@(r.Incoming ? "Yes" : "No")</td>
                            <td>
                                <button class="btn btn-sm btn-outline-secondary"
                                        disabled="@( !r.IsAnswered )"
                                        @onclick="() => DownloadAsync(r)">
                                    Download Call
                                </button>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
